(function(p,y){typeof exports=="object"&&typeof module!="undefined"?module.exports=y(require("vue")):typeof define=="function"&&define.amd?define(["vue"],y):(p=typeof globalThis!="undefined"?globalThis:p||self,p["vue-table-scroll"]=y(p.Vue))})(this,function(p){"use strict";function y(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var F=y(p);function T(e){return e?e=parseInt(e,10):e=0,e}class q{constructor(){this.tableHeader=null,this.tableData=null,this.table=null}setData(t,i){this[t]=i}updateColumns(t){let i=this.tableHeader.filter(s=>!s.hidden),n=this.table.mergeOption.index?50:0,r=0,o=0;for(let s=0;s<i.length;s++)i[s].width&&(r+=T(i[s].width),T(i[s].width)&&o++);this.tableHeader=i.map(s=>(s.width||(s.width=T((t-r-n)/(i.length-o))),s))}}function j(e){const t=new q;return t.table=e,t}function H(e,t,i){var n=i||{},r=n.noTrailing,o=r===void 0?!1:r,s=n.noLeading,l=s===void 0?!1:s,a=n.debounceMode,h=a===void 0?void 0:a,u,f=!1,c=0;function m(){u&&clearTimeout(u)}function w(){m(),f=!0}function d(){for(var _=arguments.length,O=new Array(_),g=0;g<_;g++)O[g]=arguments[g];var ge=this,B=Date.now()-c;if(f)return;function R(){c=Date.now(),t.apply(ge,O)}function ye(){u=void 0}!l&&h&&!u&&R(),m(),h===void 0&&B>e?l?c=Date.now():R():o!==!0&&(u=setTimeout(h?ye:R,h===void 0?e-B:e))}return d.cancel=w,d}function C(e,t,i){return i===void 0?H(e,t,{debounceMode:!1}):H(e,i,{debounceMode:t!==!1})}var W=function(){if(typeof Map!="undefined")return Map;function e(t,i){var n=-1;return t.some(function(r,o){return r[0]===i?(n=o,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(i){var n=e(this.__entries__,i),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(i,n){var r=e(this.__entries__,i);~r?this.__entries__[r][1]=n:this.__entries__.push([i,n])},t.prototype.delete=function(i){var n=this.__entries__,r=e(n,i);~r&&n.splice(r,1)},t.prototype.has=function(i){return!!~e(this.__entries__,i)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(i,n){n===void 0&&(n=null);for(var r=0,o=this.__entries__;r<o.length;r++){var s=o[r];i.call(n,s[1],s[0])}},t}()}(),x=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,M=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),k=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(M):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),I=2;function G(e,t){var i=!1,n=!1,r=0;function o(){i&&(i=!1,e()),n&&l()}function s(){k(o)}function l(){var a=Date.now();if(i){if(a-r<I)return;n=!0}else i=!0,n=!1,setTimeout(s,t);r=a}return l}var N=20,U=["top","right","bottom","left","width","height","size","weight"],X=typeof MutationObserver!="undefined",Y=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=G(this.refresh.bind(this),N)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var i=this.observers_,n=i.indexOf(t);~n&&i.splice(n,1),!i.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return t.forEach(function(i){return i.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!x||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),X?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!x||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var i=t.propertyName,n=i===void 0?"":i,r=U.some(function(o){return!!~n.indexOf(o)});r&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),L=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var r=n[i];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},v=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||M},$=S(0,0,0,0);function E(e){return parseFloat(e)||0}function z(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce(function(n,r){var o=e["border-"+r+"-width"];return n+E(o)},0)}function K(e){for(var t=["top","right","bottom","left"],i={},n=0,r=t;n<r.length;n++){var o=r[n],s=e["padding-"+o];i[o]=E(s)}return i}function J(e){var t=e.getBBox();return S(0,0,t.width,t.height)}function Q(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return $;var n=v(e).getComputedStyle(e),r=K(n),o=r.left+r.right,s=r.top+r.bottom,l=E(n.width),a=E(n.height);if(n.boxSizing==="border-box"&&(Math.round(l+o)!==t&&(l-=z(n,"left","right")+o),Math.round(a+s)!==i&&(a-=z(n,"top","bottom")+s)),!ee(e)){var h=Math.round(l+o)-t,u=Math.round(a+s)-i;Math.abs(h)!==1&&(l-=h),Math.abs(u)!==1&&(a-=u)}return S(r.left,r.top,l,a)}var Z=function(){return typeof SVGGraphicsElement!="undefined"?function(e){return e instanceof v(e).SVGGraphicsElement}:function(e){return e instanceof v(e).SVGElement&&typeof e.getBBox=="function"}}();function ee(e){return e===v(e).document.documentElement}function te(e){return x?Z(e)?J(e):Q(e):$}function ie(e){var t=e.x,i=e.y,n=e.width,r=e.height,o=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,s=Object.create(o.prototype);return L(s,{x:t,y:i,width:n,height:r,top:i,right:t+n,bottom:r+i,left:t}),s}function S(e,t,i,n){return{x:e,y:t,width:i,height:n}}var ne=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=S(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=te(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),re=function(){function e(t,i){var n=ie(i);L(this,{target:t,contentRect:n})}return e}(),se=function(){function e(t,i,n){if(this.activeObservations_=[],this.observations_=new W,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(t instanceof v(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)||(i.set(t,new ne(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(t instanceof v(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;!i.has(t)||(i.delete(t),i.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&t.activeObservations_.push(i)})},e.prototype.broadcastActive=function(){if(!!this.hasActive()){var t=this.callbackCtx_,i=this.activeObservations_.map(function(n){return new re(n.target,n.broadcastRect())});this.callback_.call(t,i,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),D=typeof WeakMap!="undefined"?new WeakMap:new W,A=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=Y.getInstance(),n=new se(t,i,this);D.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){A.prototype[e]=function(){var t;return(t=D.get(this))[e].apply(t,arguments)}});var oe=function(){return typeof M.ResizeObserver!="undefined"?M.ResizeObserver:A}();const ae=typeof window=="undefined",le=function(e){for(let t of e){const i=t.target.__resizeListeners__||[];i.length&&i.forEach(n=>{n()})}},he=function(e,t){ae||(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new oe(C(16,le)),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},ce=function(e,t){!e||!e.__resizeListeners__||(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())};var P={computed:{tableLayout(){let e;if(this.table&&(e=this.table||this.table.$parent),!e)throw new Error("Can not find table");return e}},mounted(){this.onColumnsChange(this.tableLayout)},updated(){this.onColumnsChange(this.tableLayout)},methods:{onColumnsChange(e){var n;const t=e.store.tableHeader,i=this.$el.querySelectorAll("colgroup > col");if(!!i.length)for(let r=e.index?1:0,o=i.length;r<o;r++){const s=i[r];s.getAttribute("name")&&s.setAttribute("width",(n=t[r])==null?void 0:n.width)}}}},ue={name:"TableBody",mixins:[P],props:{store:{required:!0}},data(){return{tooltipContent:"",tipStyle:"",tableData:this.store.tableData,arrowStyle:"",yPos:0,realBoxHeight:0}},computed:{table(){return this.$parent},pos(){return{transform:`translateY(${this.yPos}px)`,transition:"all ease-in 0",overflow:"hidden"}},defaultOption(){return{step:2,singleStep:6,hoverStop:!0,singleHeight:48,singleStepMove:!1,delayTime:2e3,waitTime:2e3}},options(){return Object.assign({},this.defaultOption,this.tableLayout.options)},hoverStopSwitch(){return this.options.hoverStop},singleStep(){let e=this.options.singleStep;return this.options.singleHeight%e!==0&&console.warn("\u5F53\u524D\u5355\u6B65\u957F\u4E0D\u662F\u5355\u6761\u6570\u636E\u9AD8\u5EA6\u7684\u7EA6\u6570,\u8BF7\u53CA\u65F6\u8C03\u6574,\u907F\u514D\u9020\u6210\u6EDA\u52A8\u9519\u4F4D*&\u2026\u2026%&"),e}},beforeCreate(){this.VM=null,this.reqFrame=null,this.singleWaitTime=null,this.isHover=!1,this.isStart=!1},mounted(){const e=this.$parent.mergeOption.bodyHeight;if(this.$el.offsetHeight>e){this.tableData.push(...this.tableData),this.isStart=!0;let i=setTimeout(()=>{this.initMove(),clearTimeout(i)},this.options.delayTime)}},beforeDestroy(){this.cancle(),this.VM&&this.VM.$destroy(),this.singleWaitTime&&clearTimeout(this.singleWaitTime)},methods:{handleCellMouseEnter(e){if(!this.table.mergeOption.showTip)return;const t=e.target,i=t.querySelector(".cell"),n=document.createRange();n.setStart(i,0),n.setEnd(i,i.childNodes.length);const r=n.getBoundingClientRect().width;if(r>i.offsetWidth){this.VM||this.createTooltip();let o=this.getOffsetTop(n);const{offsetLeft:s,arrowOffsetLeft:l}=this.getOffsetLeft(n,e,r);this.VM.$el.style.display="",this.tooltipContent=t.innerText||t.textContent,this.tipStyle=`z-index: 9999;position:fixed; left: ${s}px; top: ${o}px;`,this.arrowStyle=`left: ${l}px`}},createTooltip(){this.$createElement;const e=this;this.VM=new F.default({render(){const t=arguments[0];return t("div",{attrs:{"x-placement":"bottom"},ref:"tooltip",class:"el-tooltip__popper is-dark",style:e.tipStyle},[e.tooltipContent,t("div",{class:"popper__arrow",style:e.arrowStyle})])}}).$mount(),document.getElementsByTagName("body")[0].appendChild(this.VM.$el)},getOffsetTop(e){return e.getBoundingClientRect().top+35},getOffsetLeft(e,t,i){const n=e.getBoundingClientRect().left,r=T((i-t.target.clientWidth)/2),o=n-r,s=o<0?0:o,l=o<0?n+t.target.clientWidth/2:i/2;return{offsetLeft:s,arrowOffsetLeft:l}},handleCellMouseLeave(){this.VM&&(this.VM.$el.style.display="none")},reset(){this.cancle(),this.initMove()},cancle(){cancelAnimationFrame(this.reqFrame||"")},move(){this.isHover||(this.cancle(),this.reqFrame=requestAnimationFrame(()=>{const e=this.realBoxHeight/2;let{step:t}=this.options;Math.abs(this.yPos)>=e&&(this.yPos=0),this.yPos-=t,this.move()}))},singleMove(){this.isHover||(this.cancle(),this.reqFrame=requestAnimationFrame(()=>{const e=this.realBoxHeight/2;let{waitTime:t,singleStep:i,singleHeight:n}=this.options;Math.abs(this.yPos)>=e&&(this.yPos=0),this.yPos-=i,this.singleWaitTime&&clearTimeout(this.singleWaitTime),Math.abs(this.yPos)%n<i?this.singleWaitTime=setTimeout(()=>{this.singleMove()},t):this.singleMove()}))},initMove(){this.$nextTick(()=>{if(this.isStart){let e=setTimeout(()=>{this.realBoxHeight=this.$refs.realBox.offsetHeight,this.options.singleStepMove?this.singleMove():this.move(),clearTimeout(e)},0)}else this.cancle(),this.yPos=0})},startMove(){this.isHover=!1,this.isStart&&(this.options.singleStepMove?this.singleMove():this.move())},stopMove(){this.isHover=!0,this.singleWaitTime&&clearTimeout(this.singleWaitTime),this.cancle()}},render(){const e=arguments[0],t=this.store.tableHeader,i=this.tableData,n=this.realBoxHeight/2,{isIndex:r,showTip:o}=this.table.mergeOption,s=this.table.bodyWidth,l=this.table,a=this.pos,h=()=>{this.hoverStopSwitch&&this.stopMove()},u=()=>{this.hoverStopSwitch&&this.startMove()},f=d=>{l.$emit("lineClick",d)},c=()=>{this.yPos>0&&(this.yPos=-n),this.yPos+=20},m=()=>{Math.abs(this.yPos)>=n&&(this.yPos=0),this.yPos-=20};return e("div",{ref:"wrap"},[e("div",{class:"realBox",ref:"realBox",style:a,on:{mousewheel:d=>{this.isStart&&C(10,()=>{d.wheelDelta>0?c():m()})()},mouseenter:h,mouseleave:u}},[e("table",{class:"el-table__body",attrs:{cellspacing:"0",cellpadding:"0",border:"0"},style:`width:${s}px`},[e("colgroup",[r&&e("col",{attrs:{name:"column_0",width:"50"}}),t.map((d,_)=>!d.hidden&&e("col",{attrs:{name:`column_${_+1}`}}))]),e("tbody",[i.map((d,_)=>e("tr",{on:{click:()=>f(d)}},[r&&e("td",{class:["el-table__cell","is-center"]},[e("div",{class:["cell"]},[_+1])]),t.map(O=>!O.hidden&&e("td",{class:["el-table__cell","is-center"],on:{mouseenter:g=>this.handleCellMouseEnter(g),mouseleave:this.handleCellMouseLeave}},[e("div",{class:o?["cell","el-tooltip"]:["cell"]},[d[O.prop]])]))]))])])])])}},de={name:"TableHeader",mixins:[P],props:{store:{required:!0}},computed:{table(){return this.$parent}},render(){const e=arguments[0],t=this.store.tableHeader,i=this.table.mergeOption.index;return e("table",{class:"el-table_header",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[e("colgroup",[i&&e("col",{attrs:{name:"column_0",width:"50"}}),t.map((n,r)=>!n.hidden&&e("col",{attrs:{name:`column_${r+1}`}}))]),e("thead",{class:["is-group"]},[e("tr",[i&&e("th",{class:["el-table__cell","is-center"]},["\u5E8F\u53F7"]),t.map(n=>!n.hidden&&e("th",{attrs:{colspan:n.colSpan,rowspan:n.rowSpan},key:n.id,class:["el-table__cell","is-center"]},[e("div",{class:["cell"]},[n.label])]))])])])}},we="",fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el-table"},[i("div",{ref:"headerWrapper",staticClass:"el-table__header-wrapper"},[i("table-header",{ref:"tableHeader",style:{width:e.parentWidth?e.parentWidth+"px":""},attrs:{store:e.store}})],1),i("div",{ref:"bodyWrapper",staticClass:"el-table__body-wrapper",style:"height: "+e.mergeOption.bodyHeight+"px;"},[i("table-body",{ref:"tableBody",style:{width:e.parentWidth?e.parentWidth+"px":""},attrs:{store:e.store}})],1)])},pe=[];function ve(e,t,i,n,r,o,s,l){var a=typeof e=="function"?e.options:e;t&&(a.render=t,a.staticRenderFns=i,a._compiled=!0),n&&(a.functional=!0),o&&(a._scopeId="data-v-"+o);var h;if(s?(h=function(c){c=c||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!c&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(c=__VUE_SSR_CONTEXT__),r&&r.call(this,c),c&&c._registeredComponents&&c._registeredComponents.add(s)},a._ssrRegister=h):r&&(h=l?function(){r.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:r),h)if(a.functional){a._injectStyles=h;var u=a.render;a.render=function(m,w){return h.call(w),u(m,w)}}else{var f=a.beforeCreate;a.beforeCreate=f?[].concat(f,h):[h]}return{exports:e,options:a}}const be={name:"TableScroll",components:{TableHeader:de,TableBody:ue},props:{tableHeader:{type:Array,default:function(){return[]}},tableData:{type:Array,default:function(){return[]}},options:{type:Object,default:function(){return{}}}},data(){return{store:j(this),table:this,bodyWidth:""}},computed:{defaultOptions(){return{bodyHeight:300,index:!1,showTip:!0}},mergeOption(){return Object.assign({},this.defaultOptions,this.options)},bodyWrapper(){return this.$refs.headerWrapper},parentWidth(){const e=this.bodyWidth;return this.store.updateColumns(e),e}},watch:{tableHeader:{immediate:!0,handler(e){this.store.setData("tableHeader",e)}},tableData:{immediate:!0,handler(e){this.store.setData("tableData",e)}}},created(){this.debouncedUpdateLayout=C(50,()=>this.doLayout())},mounted(){this.bindEvents(),this.updateColumnsWidth(),this.store.updateColumns(this.bodyWidth),this.$ready=!0},destroyed(){this.unbindEvents()},methods:{bindEvents(){he(this.$el,this.resizeListener)},unbindEvents(){ce(this.$el,this.resizeListener)},resizeListener(){!this.$ready||this.updateColumnsWidth()},updateColumnsWidth(){this.bodyWidth=this.$el.clientWidth}}},V={};var me=ve(be,fe,pe,!1,_e,null,null,null);function _e(e){for(let t in V)this[t]=V[t]}var b=function(){return me.exports}();return b.install=(e,t={})=>{e.component(t.componentName||b.name,b)},typeof window!="undefined"&&window.Vue&&Vue.component(b.name,b),b});
